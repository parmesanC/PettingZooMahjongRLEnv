# 武汉麻将和牌场景全面测试设计

## 设计目标

为所有和牌类型设计全面的测试场景，包括边界条件验证。

## 测试场景列表

### 小胡测试场景（7个）

1. **硬胡自摸** - 无赖子，将2/5/8
2. **硬胡接炮** - 接他人打出的牌
3. **赖子还原硬胡** - 赖子还原后组成胡牌
4. **软胡自摸** - 1个赖子未还原
5. **软胡接炮** - 接炮+赖子
6. **未开口不能胡** - 边界条件测试
7. **小胡赖子超限** - 2个赖子不能胡（小胡最多1个）

### 大胡测试场景（8个）

8. **全求人** - 4次鸣牌+接炮
9. **清一色** - 全部同一花色
10. **碰碰胡** - 全部刻子/杠
11. **风一色** - 全部风牌
12. **将一色** - 全部2/5/8
13. **杠上开花** - 杠后摸牌自摸
14. **海底捞月** - 牌墙最后4张自摸
15. **抢杠和** - 抢补杠

---

## 场景1：硬胡自摸

### 目的
验证无赖子、将牌为2/5/8的自摸硬胡

### 条件
- 已开口
- 手牌：4面子+1将
- 将牌必须是2/5/8
- 无赖子

### 初始手牌
```
玩家0（庄家）：
  手牌：[1万,1万,1万, 2万,3万,4万, 5万,6万,7万, 8条,8条, 8筒, 9筒]
  已开口：明刻 1万

玩家1-3：随机手牌

特殊牌：
  赖子：21（非手牌中）
  皮子：19, 18

牌墙顶：8筒（将牌）
```

### 游戏流程
```
1. 玩家0碰1万（完成开口）
2. 其他玩家出牌...
3. 玩家0摸8筒
4. 玩家0自摸硬胡
```

---

## 场景2：硬胡接炮

### 目的
验证接炮硬胡

### 条件
- 已开口
- 手牌听牌
- 接他人打出的牌胡牌

### 初始手牌
```
玩家0（庄家）：
  手牌：[1万,1万,1万, 2万,3万,4万, 5万,6万,7万, 8条,8条, 8筒, 9筒]
  已开口：明刻 1万
  听牌：8筒

玩家1：
  手牌包含8筒
```

---

## 场景3：赖子还原硬胡

### 目的
验证赖子还原后算硬胡

### 条件
- 赖子还原成原牌后组成胡牌
- 胡牌时手上无赖子

### 初始手牌
```
玩家0：
  手牌：[1万,1万,1万, 2万,3万, 5万(L),6万,7万, 8筒,8筒, 9条,9条, 9筒]
  赖子=5万，还原为5筒
  牌型：111 23(L)456 88 99 9 (L还原为5筒后 345)
```

---

## 场景4：软胡自摸

### 目的
验证1个赖子的自摸软胡

### 条件
- 手牌有1个赖子未还原
- 将牌2/5/8

### 初始手牌
```
玩家0：
  手牌：[1万,1万,1万, 2万,3万, 5万(L), 8筒,8筒, 9条,9条, 9筒, 9筒, 9筒]
  赖子=5万，用于替代4万
  牌型：111 23(L)5 88 99 999
```

---

## 场景5：软胡接炮

### 目的
验证接炮+赖子软胡

### 条件
- 接他人打出的牌
- 手牌有1个赖子

### 初始手牌
```
玩家0：
  手牌：[1万,1万,1万, 2万,3万, 5万(L), 8筒,8筒, 9条,9条, 9筒, 9筒, 9筒]
  赖子=5万
  听牌：8筒

玩家1：手牌有8筒
```

---

## 场景6：未开口不能胡（边界条件）

### 目的
验证必须开口才能胡牌

### 条件
- 手牌已听牌
- 但未开口
- 不能胡牌

### 初始手牌
```
玩家0：
  手牌：[1万,1万,1万, 2万,3万,4万, 5万,6万,7万, 8筒,8筒, 8筒, 8筒]
  未开口！
  牌型：111 234 567 88 8888
```

### 预期结果
```
摸到8筒时应该不能胡（或胡牌检测失败）
```

---

## 场景7：小胡赖子超限（边界条件）

### 目的
验证小胡最多1个赖子

### 条件
- 手牌有2个赖子
- 小胡不能胡

### 初始手牌
```
玩家0：
  手牌：[1万,1万,1万, 2万,3万, 5万(L), 6万,7万, 8万(L), 9条,9条, 9筒, 9筒]
  2个赖子！
```

### 预期结果
```
应该不能胡牌（小胡赖子超限）
```

---

## 场景8：全求人

### 目的
验证全求人接炮胡牌

### 条件
- 4面子均鸣牌得来
- 手牌仅剩1张
- 只能接炮胡，不能自摸

### 初始手牌
```
玩家0（庄家）：
  手牌：[1万,1万, 1万, 2万,3万, 4万, 4万, 4万, 5万,6万, 7条,8条, 9筒]

需要完成：
  - 碰 1万
  - 吃 2,3,4万
  - 碰 4万
  - 吃 7,8,9条（需要先准备）
  剩余：9筒（将）
```

### 游戏流程
```
1. 玩家1出1万 → 玩家0碰
2. 玩家2出2万 → 玩家0吃234（需要先有3万）
3. 玩家3出4万 → 玩家0碰
4. ... 最终手牌剩9筒
5. 玩家1出9筒 → 玩家0接炮全求人
```

---

## 场景9：清一色

### 目的
验证清一色胡牌

### 条件
- 全部牌为同一花色
- ≤2个赖子

### 初始手牌
```
玩家0：
  手牌：[1万,1万,1万, 2万,3万,4万, 5万,6万,7万, 8万, 8万, 9万, 9万]
  全万字牌
  已开口：明刻1万
```

### 游戏流程
```
1. 碰1万
2. 其他出牌...
3. 摸8万或9万 → 清一色自摸/接炮
```

---

## 场景10：碰碰胡

### 目的
验证碰碰胡胡牌

### 条件
- 面子均为刻子或杠
- ≤2个赖子

### 初始手牌
```
玩家0：
  手牌：[1万,1万,1万, 3万,3万,3万, 5万,5万, 7万,7万, 8筒, 9筒, 9筒]
  已开口：明刻1万、明刻3万
```

### 游戏流程
```
1. 碰1万
2. 碰3万
3. 摸9万 → 碰碰胡
```

---

## 场景11：风一色

### 目的
验证风一色胡牌

### 条件
- 全部为风牌（东南西北中发白）
- 无需组成面子无需组成将
- ≤2个赖子

### 初始手牌
```
玩家0：
  手牌：[27东,27东,27东, 28南,28南, 29西,29西, 30北,30北, 31中, 32发, 33白, 33白]
  全风牌
  已开口：明刻东
```

---

## 场景12：将一色

### 目的
验证将一色胡牌

### 条件
- 全部为2/5/8
- 无需组成面子无需组成将
- ≤2个赖子

### 初始手牌
```
玩家0：
  手牌：[2万,2万,2万, 5万,5万,5万, 8万,8万,8万, 2条,2条, 5筒, 5筒]
  全2/5/8牌
```

---

## 场景13：杠上开花

### 目的
验证杠后摸牌自摸

### 条件
- 完成任意杠
- 杠后补牌自摸胡牌

### 初始手牌
```
玩家0（庄家）：
  手牌：[1万,1万,1万, 3条,3条, 6条,6条, 4万,5万, 7条,8条, 9筒, 9筒]
  已开口：碰1万、碰3条、碰6条
  听牌：4万

牌墙配置：
  杠尾下张：4万
```

### 游戏流程
```
1. 碰1万
2. 碰3条
3. 碰6条
4. 玩家0明杠1万
5. 杠后补牌摸4万
6. 杠上开花
```

---

## 场景14：海底捞月

### 目的
验证牌墙最后4张自摸

### 条件
- 牌墙仅剩最后4张牌
- 自摸胡牌

### 初始手牌
```
玩家0：
  手牌：[1万,1万,1万, 3万,3万,3万, 5万,5万, 7万,7万, 9条,9条, 9筒]
  已开口：碰1万、碰3万、碰5万
  听牌：9筒

牌墙最后4张：12万, 19条, 20筒, 28白
```

### 游戏流程
```
1. 碰1万
2. 碰3万
3. 碰5万
4. 摸12万，出牌
5. 摸19条，出牌
6. 摸20筒，出牌
7. 摸28白 → 替代9筒 → 海底捞月
```

---

## 场景15：抢杠和（新设计）

### 目的
验证抢补杠胡牌

### 条件
- 他人进行补杠
- 我方抢杠和牌

### 初始手牌
```
玩家0（庄家）：
  手牌：[1万,1万,1万, 2万,3万,4万, 5条,6条, 9筒, 9筒, 9筒, 33红中, 33红中]
  已开口：碰1万、明杠9筒
  听牌：5条、6条（听两头）

玩家1：
  手牌：[2万,2万, 4万,5万, 6万,7万, 7条,8条, 7筒, 8筒, 9筒, 10筒, 11条]
  已开口：碰2万

玩家2-3：随机手牌

特殊牌：
  赖子：20筒
  皮子：19条, 18条
```

### 游戏流程
```
1. 玩家0出33（红中杠）
2. 玩家1摸16万，出16万
3. 玩家2摸0万，出0万
4. 玩家3摸1万，出1万
5. 玩家0碰1万（开口）
6. 玩家0出2万
7. 玩家1补杠2万（KONG_SUPPLEMENT）
8. 玩家0抢杠和（需要5条或6条）
```

---

## 实现文件

测试将实现于：`tests/integration/test_all_win_scenarios.py`

### 牌值参考
```
万子：0-8  (1万=0, 2万=1, ..., 9万=8)
条子：9-17 (1条=9, 2条=10, ..., 9条=17)
筒子：18-26 (1筒=18, 2筒=19, ..., 9筒=26)
风牌：27-33 (东=27, 南=28, 西=29, 北=30, 中=31, 发=32, 白=33)
```

---

## 设计完成时间
2026-02-02
